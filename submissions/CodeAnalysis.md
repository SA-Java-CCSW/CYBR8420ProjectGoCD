## Code Review Strategy
Before diving into the detailed code analysis, we did a manual coarse-grained scan of GoCD's codebase to see if there is any existence of most popular CWEs(Common Weakness Enumeration) such as CWE-120/CWE-798/CWE-311/CWE-434/CWE-250/CWE-494/CWE-22/CWE-759.

Then we started with reviewing our assurance cases, misuse cases, and threat model reports. From the review, we discovered the most critical weakness areas in the software. We decided to choose the checklist review strategy, which is the most appropriate method for analyzing the code of large-scale projects like GoCD. We decided to review all 12 items from our [checklist](https://github.com/SA-Java-CCSW/CYBR8420ProjectGoCD/blob/master/CodeReview/Checklist.md).

We analyzed our code in both automated and manual review processes. The automated code review is performed using an open source static code analysis tool called SpotBugs and Findbugs. The list of resultant vulnerabilities from the automated tool scan was narrowed down to analyze CWE(Common Weakness Enumeration) that are related to our misuse case, assurance cases, and threat model and examined manually.

## Manual Code Review
**CWE-120: Classic buffer overflow**  
It seems that the chance of popular classic buffer overflow (CWE-120) in Java is minimal unless JNI(Java Native Interface) is used to call native codes written in c/c++. See https://stackoverflow.com/questions/479701/does-java-have-buffer-overflows. Searches for keyword "native"  and "System.loadLibrary" under top-level GoCD directory did not show any usage of JNI in GoCD. Therefore, GoCD does not seem to have CWE-120 issue.

**CWE-798: Use of hardcoded credentials**  
Searching with command ( grep -R "password"|less ) shows many hardcode credential usage, but most of them are from source codes written to test GoCD's functionalities. The only concern we have found is use of hardcoded credentials in source file [SystemEnvironment.java](https://github.com/gocd/gocd/blob/master/base/src/main/java/com/thoughtworks/go/util/SystemEnvironment.java):  
* `public static GoSystemProperty<String> GO_AGENT_KEYSTORE_PASSWORD = new GoStringSystemProperty("go.agent.keystore.password", "agent5s0repa55w0rd");`  
* `public static GoSystemProperty<String> GO_SERVER_KEYSTORE_PASSWORD = new GoStringSystemProperty("go.server.keystore.password", "serverKeystorepa55w0rd");`

Therefore, GoCD seems to have some CWE-798 issue.
 
**CWE-311: Missing encryption**  
Apparently, GoCD has implemented encryption feaures with source files at [such source directory](https://github.com/gocd/gocd/tree/master/config/config-api/src/main/java/com/thoughtworks/go/security).
 
**CWE-434: Unrestricted upload of file with dangerous type**  
By scanning output of 'grep -R upload|less', it seems that GoCD does not allow users to upload any files from its web GUI. The only file uploading feature in GoCD is to upload Artifact files generated by jobs on Go Agents to the predefined Artifact directory on Go Server. So, The issue of CWE-434 does not apply in GoCD.

**CWE-250: Execution with unnecessary privileges**  
We did not find any indication of this vulnerability in our analysis.

**CWE-494: Download of code without integrity check**  
By scanning output of 'grep -R checksum|less', it seems that GoCD does use MD5 checksum to check the integrity of all artifact files before using them. So, GoCD has taken care of the issue CWE-494.

**CWE-22: Path traversal**  
By scanning output of 'grep -R path|less', it seems that there are many references to controllerBasePath() and scanning output of 'grep -R controllerBasePath|less' seems to show many GoCD's web GUI URLs for different controllers are defined in source file [Routes.java](https://github.com/gocd/gocd/blob/master/spark/spark-base/src/main/java/com/thoughtworks/go/spark/Routes.java). For example, the following codes defined URLs of login and logout pages:  
`    public class LoginPage {  
        public static final String SPA_BASE = "/auth/login";  
    }  
    public class LogoutPage {  
        public static final String SPA_BASE = "/auth/logout";  
    }`
	
Therefore, GoCD does not seem to have CWE-22 issue.  
 
**CWE-759: Use of one-way hash without a salt**  
It seems that method hashCode() in source file [UsernamePassword.java](https://github.com/gocd/gocd/blob/master/server/src/main/java/com/thoughtworks/go/server/newsecurity/models/UsernamePassword.java) violates CWE-759.

**Checklist item 1: Login/authentication Components**  
After investigation, [AuthenticationController.java](https://github.com/gocd/gocd/blob/master/server/src/main/java/com/thoughtworks/go/server/newsecurity/controllers/AuthenticationController.java) appears to be the main source code for user login authentication in GoCD.  
* Method performLogin() uses a local password file based authentication plugin to authenticate user login.  
* Method redirectToThirdPartyLoginPage() redirect user's login request to proper third party login page based on the third party authentication plugin ID "pluginId".  
* Method authenticateWithWebBasedPlugin() use proper third party authentication plugin to authenticate user login. 
It seems that GoCD does not support user account lockout after N unsuccessful login attempts. It only calls method badAuthentication() to show message "Invalid credentials. Either your username and password are incorrect, or there is a problem with your browser cookies. Please check with your administrator." when authentication fails.  
* Method isSecurityEnabled() in [SecurityService.java](https://github.com/gocd/gocd/blob/master/server/src/main/java/com/thoughtworks/go/server/service/SecurityService.java) and [GoConfigService.java](https://github.com/gocd/gocd/blob/master/server/src/main/java/com/thoughtworks/go/server/service/GoConfigService.java) is to check if authentication has been enabled or not. By default authentication service is not enabled on a newly installed GoCD Server (See https://docs.gocd.org/current/configuration/dev_authentication.html).  

Many GoCD system environment constants are defined in source file [SystemEnvironment.java](https://github.com/gocd/gocd/blob/master/base/src/main/java/com/thoughtworks/go/util/SystemEnvironment.java).  
Looks like GoCD does not support IP range based ACL(Access Control List) even though there is a class called "GoAcl" in [GoAcl.java](https://github.com/gocd/gocd/blob/master/server/src/main/java/com/thoughtworks/go/server/security/GoAcl.java) which only determines if a username is contained in a list of authorizedUsers. It is used in method readAclBy() in [GoConfigService.java](https://github.com/gocd/gocd/blob/master/server/src/main/java/com/thoughtworks/go/server/service/GoConfigService.java) to create a list of authorizedUsers to access a particular stage of some pipeline. In addition, it is used in method hasOperatePermissionForStage() in [SecurityService.java](https://github.com/gocd/gocd/blob/master/server/src/main/java/com/thoughtworks/go/server/service/SecurityService.java) to determine if a particular user has operate permission for a particular stage of some pipeline.  

Overall, login/authentication components of GoCD could prevent Spoofing attacks after authentication service is enabled. However, it is better to implement IP range based ACL and auto-user account lockout after N unsuccessful login attempts to prevent DoS attacks.

**Checklist item 2: Source Materials Validation Components**   
There are configuration classes that appear to perform basic validation on the data that is provided by the config files which dictate if the data is valid or not. The config files are edited with through the web interface, or manually through a text editor on the server. "GitMaterialConfig.java" in "GoCD\config\config-api\src\main\java\com\thoughtworks\go\config\materials\git" performs some URL and hash checking to ensure if the details provided about the repository is valid. 

Admittedly, the validation mechanisms GoCD uses for its configuration files is highly decoupled and difficult to trace through. GoCD does appear to have various validation mechanisms when converting configuration files to String array representations. This can be seen in "GoCD\config\config-api\src\main\java\com\thoughtworks\go\config\validation" java classes, realized with Filter.java in "GoCD\config\config-api\src\main\java\com\thoughtworks\go\config\materials", and GitMaterialConfig.java.

In "GoCD\server\src\main\java\com\thoughtworks\go\server\service" the java class "MaterialService.java" shows that GoCD creates a unique fingerprint that validates the Material's repository. This data structure can be viewed in MaterialConfig.java located "GoCD\config\config-api\src\main\java\com\thoughtworks\go\domain\materials" with the code `String getFingerprint();`. This fingerprint protects against repository spoofing attack. 

**Checklist item 3: Backup/restore Components**  
[BackupsController.java](https://github.com/gocd/gocd/blob/master/api/api-backups-v1/src/main/java/com/thoughtworks/go/apiv1/admin/backups/BackupsController.java) is the main source code for user to perform the backup process in GoCD.
* Method setupRoutes() handles backup content type, verify backup confirm and authentication processes.
* Method create() handles request and response. Backup server runs based on the current user name and inform user the backup result.
* Method verifyConfirmHeader() verify request to see if it is satisfied in certain condition.

[BackupConfigRepresenter.java](https://github.com/gocd/gocd/blob/master/api/api-backup-config-v1/src/main/java/com/thoughtworks/go/apiv1/backupconfig/representers/BackupConfigRepresenter.java) is code that allows user to configure backup settings for the GoCD server.   
* Method toJSON() and method fromJSON() contain JSON object with information that lets user know about backup process is success or not.

**Checklist item 4: Poll Material Source Components**  
The data structure defined in the configuration files is represented by `boolean isAutoUpdate();` in MaterialConfig.java located "GoCD\config\config-api\src\main\java\com\thoughtworks\go\domain\materials". This boolean value defines whether or not this is manual pull or automatic poll. 

This is ultimately represented by code in implementations in ManualPipelineChecker.java in "GoCD/server/serc/main/java/com/thoughworks/go/server/service" with code such as:

`        if (pipelineConfig.isFirstStageManualApproval()) {
            String message = String.format("Failed to trigger pipeline [%s]", pipelineConfig.name());
            result.error(message, String.format("The first stage of pipeline \"%s\" has manual approval",
                                pipelineConfig.name()), type);
        } else {
            result.success(type);
        }
`

This implementation enforces that the Material Source has a manual approval process that can be enabled to prevent attacks.

**Checklist item 5: Pipeline Workflow Components**  
It appears the pipeline workflow components of GoCD involve the source files: GoConfigFileHelper.java and DatabaseAccessHelper.java. Methods addPipeline(), addPipelineToGroup(), updatePipeline(), addStageToPipeline(), addEnvironmentVariableToPipeline(), removePipeline(), addJobToStage(), addMaterialConfigForPipeline(), lockPipeline(), addPipelineCommand() in [GoConfigFileHelper.java](https://github.com/gocd/gocd/blob/master/server/src/test-shared/java/com/thoughtworks/go/util/GoConfigFileHelper.java) and methods configurePipeline(), schedulePipeline(), scheduleJobInstancesAndSavePipeline() in [DatabaseAccessHelper.java](https://github.com/gocd/gocd/blob/master/server/src/test-shared/java/com/thoughtworks/go/server/dao/DatabaseAccessHelper.java) clearly showed the workflow of pipeline in GoCD. None of these have elevation of privileges concerns.

Overall, pipeline workflow components of GoCD could prevent elevation of privileges attacks.

**Checklist item 6: Web UI Component**  
Web UI source code is located in the following two folders:
* gocd\server\src\main\java\com\thoughtworks\go\server\ui: has individual java files to handle Agent, PluginInfo, Environment, Job, Pipeline Notification, Stage, Template UI view. these java files have getter, equals(), toString() methods. controller/ResponseRedirector.java file is the ui controller, which redirects response to text/html content using UTF-8 encoding.
* gocd\server\src\test-fast\java\com\thoughtworks\go\server\ui (for auto-tool testing)

**Checklist item 7: material update sub-system(MCU) component**  
Deployment pipeline runs when a material is added. In most cases, it is a source code material repository. GoCD server continuously polls the configured materials and when a new change or commit is found. A pipeline can even be configured with multiple materials.    
[ServerMaintenanceModeControllerv1.java](https://github.com/gocd/gocd/blob/master/api/api-server-maintenance-mode-v1/src/main/java/com/thoughtworks/go/apiv1/servermaintenancemode/ServerMaintenanceModeControllerV1.java) is the main source code to determine which the internal subsystems and processes continue to work.
* Method enableMaintenanceModeState() handles the existing maintenance mode state and notice user with certain information by checking the method existingMaintenanceModeState() first to see if the server is available in maintenance mode. 
* Comparing to the method enableMaintenanceModestate(), method disableMaintenanceModeState() works in the opposite way, and handles the existing maintenance mode state and notice user with certain information if the server is available.
* Method getRunningJobs() returns information about the current running job instances. In this method, each running pipeline instance in GoDashboardPipeline.java is collected and return as a list object.

**Checklist item 8: Plugin Extension Point Component**  
Plugin Extension Point Component has the following source code folders:
* gocd\server\src\test-fast\java\com\thoughtworks\go\server\service\plugins (mainly include auto-test code)
* gocd\server\src\main\java\com\thoughtworks\go\server\service\plugins: AnalyticsPluginAssetsService.java takes care of metadata and assets generation/removal using PluginID. Plugin ID is used for metadata store/remove in onPluginMetadataStoreCreate()/onPluginMetadataRemove() methods. Plugin Assets are encoded using hard-code hash algorithm "SHA-256" in cacheStaticAssets() method.
InvalidPluginTypeException.java defines plugin invalid exception.

* gocd\server\src\main\webapp\WEB-INF\rails\app\views\admin\tasks\plugin (html form pages for plugin)
* gocd\config\config-api\src\main\java\com\thoughtworks\go\plugins
* gocd\plugin-infra\go-plugin-access: implements plugin registry, information, logger, and handles request on access point.
* gocd\plugin-infra\go-plugin-api: defines the interface for go plugin api communication. It also includes handling for material and task.
* gocd\plugin-infra\go-plugin-domain: defines several diferent kinds of plugins' info class, including AnalyticsPlugin, ArtifactPlugin, AuthorizationPlugin, ConfigRepoPlugin, ElasticAgentPlugin, NotificationPlugin, PackageMaterialPlugin etc.
* gocd\plugin-infra\go-plugin-configrepo: defines adapters for Artifact, Material, Task.
* gocd\plugin-infra\go-plugin-infra: implements high level services for plugin load/unload, validation, management. It includes plugin jar change listener, Plugin change monitor, logging and registry service.
* gocd\plugin-infra\go-plugin-activator: implements methods for plugin loading/unloading, registry, validation in DefaultGoPluginActivator.java file.
* gocd\plugin-infra\go-plugin-api-internal: defines interfaces for plugin api logger and plugin registry service. No actual implmentation is done.
* gocd\plugin-infra\plugins: auto-test source code.
* gocd\api\api-plugin-images: PluginImagesController.java file handles request for plugin image.
* gocd\api\api-plugin-infos-v6 (converts plugin information to json)
* gocd\api\api-plugin-settings-v1 (converts plugin settings to json)

Default plugin extensions includes AuthorizationExtension, SCMExtension, ConfigRepoExtension, ElasticAgentExtension, TaskExtension, PackageMaterialExtension, NotificationPlugin, AnalyticsPlugin, ArtifactPlugin, SecretsExtension. 


**Checklist item 9: Authorization Component**  
It appears the authorization component of GoCD mainly involves two source files: [SecurityService.java](https://github.com/gocd/gocd/blob/master/server/src/main/java/com/thoughtworks/go/server/service/SecurityService.java) and [GoConfigService.java](https://github.com/gocd/gocd/blob/master/server/src/main/java/com/thoughtworks/go/server/service/GoConfigService.java).  
Based on method isAdmin() in [SecurityConfig.java](https://github.com/gocd/gocd/blob/master/config/config-api/src/main/java/com/thoughtworks/go/config/SecurityConfig.java) there are three ways to get Administrator permission in GoCD:  
* !isSecurityEnabled() means no authentication is enabled after initial GoCD installation by default.  
* noAdminsConfigured() means no user is assigned Administrator role by default.  
* adminsConfig.isAdmin(admin, rolesConfig.memberRoles(admin)) means the user is a member of Administrator role.  
This is consistent with GoCD's documentation https://docs.gocd.org/current/configuration/dev_authorization.html .  
Therefore, a new user is actually given Administrator permission if none of existing users has been assigned as Administrator role.  

Methods canEditPipeline(), isGroupAdministrator(), isUserAdminOfGroup(), isUserTemplateAdmin() in source file [GoConfigService.java](https://github.com/gocd/gocd/blob/master/server/src/main/java/com/thoughtworks/go/server/service/GoConfigService.java) clearly showed GoCD's role-based authorization feature.  
Overall, authorization component of GoCD could prevent elevation of privileges attacks. However, giving a new user Administrator permission as default is not secure.  

**Checklist item 10: SSL/TLS component**  
Source code folder for agents using the SSL/TLS component is "gocd\base\src\main\java\com\thoughtworks\go\agent\common\ssl\" with class CertificateFileParser.java. The classes `certificates()` method generates a list of "X.509" certificates with "X.509" hard-coded. This "X.509" certificate is used for agent trust store using X500Principle in GoAgentServerClientBuilder.java file. GoAgentServerHttpClientBuilder.java creates HttpClient object with SSL certificate. GoAgentServerHttpClient.java file handles HtpRequest with closable-http-response in `execute()` methods, it also has `close()` and `reset()` methods to close http client.

GoCD excludes certain protocols in java classes in "GoCD\jetty9\src\main\java\com\thoughtworks\go\server\config". The class takes information through the "SystemEnvironment.java" file that is found in "GoCD\base\src\main\java\com\thoughtworks\go\util". The file defines the System Environment, including excluded ciphers and protocols. 

SystemEnvironment.java class located in "GoCD\base\src\main\java\com\thoughtworks\go\util" defines what ciphers are excluded and what are included. This includes SSL/TLS certificates. This feature is to guard against insecure certificates to be used by GoCD. Through this file, we see that by default, GoCD uses TLSv2, which is a secure protocol for X509 certificates. This can be seen in the code `GO_SSL_TRANSPORT_PROTOCOL_TO_BE_USED_BY_AGENT = new GoStringSystemProperty("go.ssl.agent.protocol", "TLSv1.2");`. Many classes implement this java class to define what is allows and what is not. 

It should be noted that what is found in SystemEnvironment.java is consistent with GoCD documentation. [GoCD Documentation](https://docs.gocd.org/current/installation/ssl_tls/setting_up_ciphers.html) has mentioned this: "The default transport protocol that agent uses to communicate with Go server is TLSv1.2. This can be overridden by configuring property go.ssl.agent.protocol to a suitable value based on your requirements."

Between agents (processes that do the work across the pipelines in GoCD), SSL/TLS validaiton is performed through SSLInfrastructureService.java. Errors will be delivered to a LOGGER object, then returned in a string as a response. 

Validation is performed with classes in directory "GoCD\base\src\main\java\com\thoughtworks\go\agent\common\ssl", including a null check in GoAgentServerHttpClient.java to protect against malformed certificates that failed to properly create the client object for the ssl/tls connection. Additionally, GoCD accurately implements library `org.apache.http.conn.ssl` for verification of valid SSL/TLS certificates in "SslVerificationMode.java" located in "GoCD\base\src\main\java\com\thoughtworks\go\util".

Through code analysis, it appears that GoCD is accurately validating TLS certificates, and excluding insecure protocols, such as SSL by default. 

**Checklist item 11: Check authentication configuration component against CSRF attack**  
[AgentsControllerV6.java](https://github.com/gocd/gocd/blob/master/api/api-agents-v6/src/main/java/com/thoughtworks/go/apiv6/agents/AgentsControllerV6.java) is the main source code to allow users with administrator role to manage agents.
* Method update() determines agent’s update action of agent with its id. If the updateAgentAttributes successfully update the agent’s attribute, then call the method handleUpdateAgentResponse(). Exception will be handled if the update attribute method throws exception.
* Method bulkUpdate() handles attribute update of agent with certain id. If the update action is successfully finished, text explanation is printed out. Otherwise, exception is handled.
* Method deleteAgents() accepts request to handle deletion of specific agent with text explanation if no exception occurs.
* Method checkSecurityOr403() handles GET request with apiAuthenticationHelper component.
* Method handleCreateOrUpdateResponse() handles response of new agent’s register or update status’s of existing agent.
* Method handleUpdateAgentResponse() handles response of specific agent’s update status and inform user with text explanation. 

**Checklist item 12: Investigate usage of JRuby on Rails framework against CSRF attack**  
In directory "GoCD\server\src\main\webapp\WEB-INF\rails" is where the Ruby on Rails front-end is stored. A grep search shows that the "config.force_ssl" is commented out in "GoCD\server\src\main\webapp\WEB-INF\rails\config\environments", and should be changed to "true" in order to enforce SSL/TLS connections to the Rails front-end app when users access the web interface. However, the Servlet side does enforce SSL/TLS connections in ServerConfigService.java in line 108 through an @Override method with the code `ServerSiteUrlConfig siteUrl = forceSsl || (scheme != null && scheme.equals("https")) ? getSecureSiteUrl() : serverConfig().`. The authors decided to enforce the URI details, including forcing SSL/TLS, within the Servlet/Java-side. No bugs seem to be identified through this implementation.

GoCD contains validator classes in directory "GoCD\server\src\main\java\com\thoughtworks\go\validators". The Validators check for correct IP and port, and include whitelisting of characters for network connections. The files contain: HostNameValidator.java, PortValidator.java, Validator.java classes. These validators help protect against forms of network attacks by ensuring correctness. Finally, GoCD uses `URISyntaxException` to ensure that the config files are properly using proper URI syntax in "GoCD\server\src\main\java\com\thoughtworks\go\server\web\BaseUrlProvider.java". 

The cookie session store and generation is handled by Java Servlet as defined by session_store.rb. The implementation can be found in "GoCD\server\src\main\java\com\thoughtworks\go\server\web" directory.

Rails manages their post and get functions inside the routes.rb class. The file routes.rb is found in "GoCD\server\src\main\webapp\WEB-INF\rails\config". As a rule, any [state changes](https://tools.ietf.org/html/rfc7231#section-4.2.1) should not use GET requests. Every route that is using the GET method should be accessing a page or requesting information, while every POST method should be creating or updating information in the database. This functionality is largely consistent in the routes.rb to protect against CSRF attacks. One line of concern is the following since the function is making a change on the server.
* On line 69, `get "admin/config_change/between/:later_md5/and/:earlier_md5" => 'admin/stages#config_change', as: :admin_config_change` might need a `post` instead of a `get`. Looking at the view, the 
Additionally, the Rail controllers use the function expect() as an additional mechanism to enforce the type of method (POST or GET) on html requests.

## Automated Tool Scan
After exploring the DHS SWAMP scanning platform we attempted to use the system to scan the GoCD source code files. However, the SWAMP platform does not support JDK 11 or above which is required to build GoCD source codes to byte code. Therefore, we directly downloaded precompiled GoCD byte codes in .zip format from https://www.gocd.org/download/#zip and uploaded them to https://www.mir-swamp.org/ to perform various assessments on the byte codes. We did successfully use the SWAMP platform to scan the GoCD Java Bytecode with SpotBugs 3.1.12.  We also used the OWASP Dependency Check 2.1.1 tool to scan the Java code files, but it did not find any issues. Finally, we used RuboCop to scan the Ruby on Rails portion of the server. 

#### Findbugs 3.0.1
This tool is a Desktop installed software. It was used to scan GoCD Java Bytecode for both Go Server (lib/go.class file) and Go Agent (lib/agent-bootstrapper.class file). 
For Go Server and Go Agent, the same results are found (see [findbugs_server_result](https://github.com/SA-Java-CCSW/CYBR8420ProjectGoCD/blob/master/CodeReview/findbugs_goServer.xml) and [findbugs_agent_result](https://github.com/SA-Java-CCSW/CYBR8420ProjectGoCD/blob/master/CodeReview/findbugs_goAgent.xml)). 4 bugs are found, 2 of them are bad practices, 1 is incorrect lazy initialization, and the last one is inner class that could be made static. 
Dubious method used (bad practice) are found in two locations (com.thoughtworks.gocd.Boot.run() method at gocd\jar-class-loader\src\main\java\com\thoughtworks\gocd\Boot.java line#93; com.thoughtworks.gocd.AssertJava.checkSupported(JavaVersion) method at gocd\jar-class-loader\src\main\java\com\thoughtworks\gocd\AssertJava.java line#38) where System.exit() are invoked. They belong to CWE-382: J2EE Bad Practices: Use of System.exit(). A J2EE application uses System.exit(), which also shuts down its container. It is never a good idea for a web application to attempt to shut down the application container. Access to a function that can shut down the application is an avenue for Denial of Service (DoS) attacks.

Incorrect lazy initialization of static field JavaVersion currentJavaVersion at JavaVersion.java [lines81-82] in method com.thoughtworks.gocd.JavaVersion.current() on field com.thoughtworks.JavaVersion.currentJavaVersion. The class Handler$1 could be refactored into a named _static_inner class at Handler.java [lines 55-65] in class com.thoughtworks.gocd.onejar.Handler$1. 

#### SpotBugs 3.1.12
This tool was used in the SWAMP platform to scan the GoCD Java Bytecode. As shown in the [summary](https://github.com/SA-Java-CCSW/CYBR8420ProjectGoCD/blob/master/CodeReview/SpotBugs-Scan-Summary.pdf) it has found total 40034 bugs. It turned out that only 152 bugs are related to security or malicious codes groups based on our manual scan of the generated assessment results. As a matter of fact only 23 lines of source codes are from GoCD, the rest are from third-party libraries which is beyond the scope of our code analysis. We further selected 14 bugs which are worth investigations by GoCD development team as shown below:  
**Security Concern 1: Missing Support for Cipher Integrity Check(CWE-353)**  
This [concern](https://github.com/SA-Java-CCSW/CYBR8420ProjectGoCD/blob/master/CodeReview/SpotBugs-CIPHER_INTEGRITY-AESEncrypter.pdf) is due to usage of insecure Java Cipher API call Cipher.getInstance("AES/CBC/PKCS5Padding") in line 62 and 85 of source file [AESEncrypter.java](https://github.com/gocd/gocd/blob/master/config/config-api/src/main/java/com/thoughtworks/go/security/AESEncrypter.java). Even though GoCD does explicitly provide algorithm(AES), cipher mode(CBC) and padding scheme(PKCS5Padding) as the transformation to avoid the IND-CPA insecure ECB cipher mode as mentioned in a [software security research article](https://dl.acm.org/citation.cfm?doid=2508859.2516693), it is still recommended to use more secure GCM cipher mode to mitigate this security concern.  
**Security Concern 2: Use of Hard-coded Password(CWE-259)**  
This [concern](https://github.com/SA-Java-CCSW/CYBR8420ProjectGoCD/blob/master/CodeReview/SpotBugs-HARD_CODE_PASSWORD.pdf) is due to usage of hard-coded password in line 280 and 289 of source file [MaterialConfigs.java](https://github.com/gocd/gocd/blob/master/config/config-api/src/main/java/com/thoughtworks/go/config/materials/MaterialConfigs.java) and line 214/243/245 of source file [X509CertificateGenerator.java](https://github.com/gocd/gocd/blob/master/common/src/main/java/com/thoughtworks/go/security/X509CertificateGenerator.java). Hard-coded passwords should always be removed.  
**Security Concern 3: Use of Insufficiently Random Values(CWE-330)**  
This [concern](https://github.com/SA-Java-CCSW/CYBR8420ProjectGoCD/blob/master/CodeReview/SpotBugs-PREDICTABLE_RANDOM%20.pdf) is due to usage of less secure random number generator in line 82 of source file [DownloadAction.java](https://github.com/gocd/gocd/blob/master/common/src/main/java/com/thoughtworks/go/domain/DownloadAction.java), in line 264 of source file [X509CertificateGenerator.java](https://github.com/gocd/gocd/blob/master/common/src/main/java/com/thoughtworks/go/security/X509CertificateGenerator.java), and line 55 of source file [SystemUtil.java](https://github.com/gocd/gocd/blob/master/base/src/main/java/com/thoughtworks/go/util/SystemUtil.java). More secure java.security.SecureRandom API should be used.  
**Security Concern 4: Cleartext Transmission of Sensitive Information(CWE-319)**  
This [concern](https://github.com/SA-Java-CCSW/CYBR8420ProjectGoCD/blob/master/CodeReview/SpotBugs-UNENCRYPTED_SOCKET.pdf) is due to usage of unencrypted Socket in line 136 of source file [SystemUtil.java](https://github.com/gocd/gocd/blob/master/base/src/main/java/com/thoughtworks/go/util/SystemUtil.java). A more secure SSL Socket should be used.  
**Security Concern 5: OS Command Injection(CWE-78)**  
This [concern](https://github.com/SA-Java-CCSW/CYBR8420ProjectGoCD/blob/master/CodeReview/SpotBugs-COMMAND_INJECTION.pdf) is due to usage of java/lang/ProcessBuilder.command in line 172 of source file [AgentProcessParentImpl.java](https://github.com/gocd/gocd/blob/master/agent-process-launcher/src/main/java/com/thoughtworks/go/agent/AgentProcessParentImpl.java), line 37 of source file [ProcessRunner.java](https://github.com/gocd/gocd/blob/master/util/src/main/java/com/thoughtworks/go/util/command/ProcessRunner.java), line 48 of source file [ProcessManager.java](https://github.com/gocd/gocd/blob/master/commandline/src/main/java/com/thoughtworks/go/util/ProcessManager.java) and line 45 of source file [CommandUtils.java](https://github.com/gocd/gocd/blob/master/util/src/main/java/com/thoughtworks/go/utils/CommandUtils.java).  
**Security Concern 6: XPath Injection(CWE-643)**  
This [concern](https://github.com/SA-Java-CCSW/CYBR8420ProjectGoCD/blob/master/CodeReview/SpotBugs-XPATH_INJECTION.pdf) is due to usage of javax/xml/xpath/XPath.compile in line 51 of source file [XpathUtils.java](https://github.com/gocd/gocd/blob/master/config/config-api/src/main/java/com/thoughtworks/go/util/XpathUtils.java).  
**Security Concern 7: Information Exposure Through DiscrepancyKey(CWE-203)**  
This [concern](https://github.com/SA-Java-CCSW/CYBR8420ProjectGoCD/blob/master/CodeReview/SpotBugs-UNSAFE_HASH_EQUALS.pdf) is due to usage of unsafe comparison of hash that are susceptible to timing attack in line 108 of source file [AgentUpgradeService.java](https://github.com/gocd/gocd/blob/master/agent/src/main/java/com/thoughtworks/go/agent/service/AgentUpgradeService.java) and line 40 of source file [ChecksumValidator.java](https://github.com/gocd/gocd/blob/master/common/src/main/java/com/thoughtworks/go/validation/ChecksumValidator.java).  
**Security Concern 8: Open Redirect(CWE-601)**  
This [concern](https://github.com/SA-Java-CCSW/CYBR8420ProjectGoCD/blob/master/CodeReview/SpotBugs-UNVALIDATED_REDIRECT.pdf) is due to usage of unvalidated redirection in line 62 of source file [GoServerLoadingIndicationHandler.java](https://github.com/gocd/gocd/blob/master/jetty9/src/main/java/com/thoughtworks/go/server/GoServerLoadingIndicationHandler.java).  
**Security Concern 9: HTTP Parameter Pollution(CAPEC-460)**  
This [concern](https://github.com/SA-Java-CCSW/CYBR8420ProjectGoCD/blob/master/CodeReview/SpotBugs-HTTP_PARAMETER_POLLUTION.pdf) is due to usage of unvalidated redirection in line 110 of source file [ServerBinaryDownloader.java](https://github.com/gocd/gocd/blob/master/agent-common/src/main/java/com/thoughtworks/go/agent/launcher/ServerBinaryDownloader.java), in line 115 of source file [AgentUpgradeService.java](https://github.com/gocd/gocd/blob/master/agent/src/main/java/com/thoughtworks/go/agent/service/AgentUpgradeService.java) and line 156 of source file [HttpService.java](https://github.com/gocd/gocd/blob/master/common/src/main/java/com/thoughtworks/go/util/HttpService.java).  
**Security Concern 10: Malicious Code**  
This [concern](https://github.com/SA-Java-CCSW/CYBR8420ProjectGoCD/blob/master/CodeReview/SpotBugs-DP_CREATE_CLASSLOADER_INSIDE_DO_PRIVILEGED.pdf) is due to creation of classloader not within a doPrivileged block in line 110/111 of source file [JarUtil.java](https://github.com/gocd/gocd/blob/master/agent-common/src/main/java/com/thoughtworks/go/agent/common/util/JarUtil.java).  
**Security Concern 11: Improper Handling of Parameters(CWE-233)**   
This [concern](https://github.com/SA-Java-CCSW/CYBR8420ProjectGoCD/blob/master/CodeReview/SpotBugs-C-USBR_UNNECESSARY_STORE_BEFORE_RETURN.pdf) about situation in [BackupConfig.java](https://github.com/gocd/gocd/blob/master/config/config-api/src/main/java/com/thoughtworks/go/config/BackupConfig.java): software does not properly handle when the expected number of parameters, fields, or arguments is not provided in input, or if those parameters are undefined.  
**Security Concern 12: Improper Validation of Integrity Check Value (CWE-354)**   
This [concern](https://github.com/SA-Java-CCSW/CYBR8420ProjectGoCD/blob/master/CodeReview/SpotBugs-C-SEC_SIDE_EFFECT_CONSTRUCTOR.pdf) is about methods in setBackupDate, getBackupDate in class AppleForkedDateEntry that methods do not validate or incorrectly validates the integrity check values.   
**Security Concern 13: Uncontrolled Resource Consumption(CWE-400)**   
This [concern](https://github.com/SA-Java-CCSW/CYBR8420ProjectGoCD/blob/master/CodeReview/SpotBugs-C-EI_EXPOSE_REP.pdf) is about software does not properly control the allocation and maintenance of a limited resource thereby enabling an actor to influence.  
**Security Concern 14: External Control of Critical State Data(CWE-642)**   
This [concern](https://github.com/SA-Java-CCSW/CYBR8420ProjectGoCD/blob/master/CodeReview/SpotBugs-C-EXS_EXCEPTION_SOFTENING_HAS_CHECKED.pdf) is about method getScriptedObject stores security-critical state information about its users that is accessible to unauthorized actors.  

#### RuboCop 0.47
This tool was used in the SWAMP platform to scan the GoCD Ruby on Rails webapp.  As shown in the [summary](https://github.com/SA-Java-CCSW/CYBR8420ProjectGoCD/blob/master/CodeReview/RuboCop-Scan-Summary.pdf) the tools has found total 293 bugs. The "bugs" are style issues with no serious vulnerabilities identified.

### Project Links
* Team Repository: https://github.com/SA-Java-CCSW/CYBR8420ProjectGoCD
* Project Board: https://github.com/SA-Java-CCSW/CYBR8420ProjectGoCD/projects/5
* Reflection Meeting (December) https://github.com/SA-Java-CCSW/CYBR8420ProjectGoCD/blob/master/submissions/ReflectionMeetingDec.md
* CodeDx Assessment Report https://github.com/SA-Java-CCSW/CYBR8420ProjectGoCD/blob/master/CodeReview/CodeDx-SecurityScan.pdf
